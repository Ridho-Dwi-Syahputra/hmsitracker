<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Edit Profil DPA</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-orange-50 min-h-screen">

  <!-- Sidebar -->
  <%- include('../partials/sidebarDPA', { activeNav: 'Profil', user: user }) %>

  <!-- Wrapper -->
  <div class="lg:ml-80 px-4 sm:px-6 py-8">
    <div class="max-w-2xl mx-auto bg-white shadow-xl rounded-2xl overflow-hidden border border-orange-200">

      <!-- Header -->
      <div class="bg-orange-500 text-white px-6 py-6">
        <h1 class="text-xl sm:text-2xl font-bold">Edit Profil DPA</h1>
        <p class="text-sm text-orange-100">Perbarui informasi akun DPA Anda</p>
      </div>

      <!-- Body -->
      <div class="p-6 sm:p-8 space-y-6">

        <!-- Flash Messages -->
        <% if (errorMsg && errorMsg.length > 0) { %>
          <% errorMsg.forEach(msg => { %>
            <div class="p-4 bg-red-100 text-red-700 rounded-xl text-sm mb-2"><%= msg %></div>
          <% }) %>
        <% } %>
        <% if (successMsg && successMsg.length > 0) { %>
          <% successMsg.forEach(msg => { %>
            <div class="p-4 bg-green-100 text-green-700 rounded-xl text-sm mb-2"><%= msg %></div>
          <% }) %>
        <% } %>

        <!-- Form Update Profil -->
        <form id="editProfileForm" action="/dpa/profile/update" method="POST" enctype="multipart/form-data" class="space-y-6">

          <!-- Foto Profil -->
          <div class="flex flex-col items-center gap-4">
            <div class="w-40 h-40 rounded-full overflow-hidden border shadow-md">
              <img id="previewFoto" 
                   src="/<%= user.foto_profile || 'default-profile.png' %>"
                   class="w-full h-full object-cover"
                   alt="Foto Profil">
            </div>

            <!-- input file -->
            <input type="file" id="fotoInput" name="foto_profile" accept="image/*" class="hidden">
            <label for="fotoInput"
                   class="cursor-pointer bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-xl text-sm">
              Pilih Foto
            </label>
          </div>

          <!-- NIM -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">NIM</label>
            <input type="text" name="id_anggota" value="<%= user.id_anggota %>" required
                   class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-orange-400">
          </div>

          <!-- Nama -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Nama</label>
            <input type="text" name="nama" value="<%= user.nama %>" required
                   class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-orange-400">
          </div>

          <!-- Password -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Password Baru</label>
            <div class="relative">
              <input type="password" id="password" name="password"
                     class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-orange-400 pr-10">
              <button type="button" onclick="togglePassword('password','eye1')" 
                      class="absolute inset-y-0 right-3 flex items-center text-gray-500">
                <svg id="eye1" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Konfirmasi Password -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-1">Konfirmasi Password</label>
            <div class="relative">
              <input type="password" id="confirm_password" name="confirm_password"
                     class="w-full px-4 py-3 border rounded-xl focus:ring-2 focus:ring-orange-400 focus:border-orange-400 pr-10">
              <button type="button" onclick="togglePassword('confirm_password','eye2')" 
                      class="absolute inset-y-0 right-3 flex items-center text-gray-500">
                <svg id="eye2" xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                </svg>
              </button>
            </div>
          </div>

          <!-- Buttons -->
          <div class="flex flex-col sm:flex-row justify-between gap-3 pt-4 border-t">
            <a href="/dpa/profile"
               class="w-full sm:w-auto px-4 py-2 border border-gray-400 text-gray-600 rounded-xl text-center hover:bg-gray-100">
              Kembali
            </a>
            <button type="submit"
                    class="w-full sm:w-auto bg-orange-500 hover:bg-orange-600 text-white px-4 py-2 rounded-xl font-medium">
              Simpan Perubahan
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- JS Toggle Password -->
  <script>
    function togglePassword(inputId, eyeId) {
      const input = document.getElementById(inputId);
      const eye = document.getElementById(eyeId);

      if (input.type === "password") {
        input.type = "text";
        eye.innerHTML = `
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.542-7a9.97 9.97 0 012.396-3.742m3.126-2.212A9.956 9.956 0 0112 5c4.478 0 8.268 2.943 9.542 7a9.969 9.969 0 01-4.043 5.066M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>`;
      } else {
        input.type = "password";
        eye.innerHTML = `
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>`;
      }
    }

    // Preview foto sebelum submit
    const fotoInput = document.getElementById("fotoInput");
    const previewFoto = document.getElementById("previewFoto");
    fotoInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        previewFoto.src = URL.createObjectURL(file);
      }
    });
  </script>
</body>
</html>
