<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Profil Pengurus</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
    }
    
    @keyframes fadeIn { 
      from { opacity: 0; transform: translateY(10px); } 
      to { opacity: 1; transform: translateY(0); } 
    }
    
    @keyframes slideIn { 
      from { opacity: 0; transform: scale(0.95); } 
      to { opacity: 1; transform: scale(1); } 
    }
    
    .animate-fade-in { 
      animation: fadeIn 0.6s ease-out forwards; 
    }
    
    .animate-slide-in { 
      animation: slideIn 0.3s ease-out forwards; 
    }
    
    .glass-effect {
      backdrop-filter: blur(12px);
      background: rgba(255, 255, 255, 0.95);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    
    .hover-lift {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .hover-lift:hover {
      transform: translateY(-2px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen">

  <!-- Sidebar placeholder -->
  <!-- <%- include('../partials/sidebarHMSI', { user: user, activeNav: 'Settings' }) %> -->

  <!-- Main Content -->
  <div class="lg:ml-80 px-4 sm:px-6 py-8 animate-fade-in">
    <div class="max-w-2xl mx-auto">
      
      <!-- Profile Card -->
      <div class="bg-white rounded-3xl shadow-xl shadow-gray-200/50 overflow-hidden hover-lift">
        
        <!-- Header Section -->
        <div class="relative bg-gradient-to-r from-orange-500 via-orange-600 to-orange-500 px-6 py-6">
          <div class="absolute inset-0 bg-black/5"></div>
          <div class="relative z-10">
            <h1 class="text-xl sm:text-2xl font-bold text-white mb-1">Profil Pengurus</h1>
            <p class="text-orange-100 text-sm font-medium">Kelola informasi akun dan pengaturan</p>
          </div>
          <!-- Decorative circles -->
          <div class="absolute top-4 right-4 w-20 h-20 rounded-full bg-white/10"></div>
          <div class="absolute top-8 right-8 w-12 h-12 rounded-full bg-white/5"></div>
        </div>

        <!-- Profile Content -->
        <div class="p-6">
          
          <!-- Profile Header -->
          <div class="flex flex-col sm:flex-row items-center gap-4 mb-6 pb-4 border-b border-gray-100">
            <div class="relative group">
              <!-- Profile Picture -->
              <div class="relative">
                <% if (typeof user !== 'undefined' && user.foto_profile) { %>
                  <img src="/uploads/<%= user.foto_profile %>" alt="Foto Profil"
                    class="w-24 h-24 rounded-2xl border-4 border-white shadow-lg object-cover ring-2 ring-gray-100">
                <% } else { %>
                  <div class="w-24 h-24 rounded-2xl bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center text-white font-bold text-3xl shadow-lg ring-2 ring-gray-100">
                    <%= typeof user !== 'undefined' ? (user.nama || 'A').charAt(0).toUpperCase() : 'A' %>
                  </div>
                <% } %>
                
                <!-- Upload Button -->
                <div class="absolute -bottom-1 -right-1">
                  <button id="editPhotoBtn" class="cursor-pointer bg-orange-500 hover:bg-orange-600 p-2 rounded-lg shadow border-2 border-white transition-colors duration-200 flex items-center justify-center">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                  </button>
                </div>
              </div>
            </div>
            
            <!-- Profile Info -->
            <div class="text-center sm:text-left flex-1">
              <h2 class="text-xl sm:text-2xl font-bold text-gray-900 mb-1">
                <%= typeof user !== 'undefined' ? user.nama : 'Nama Pengguna' %>
              </h2>
              <p class="text-gray-500 text-sm font-medium mb-2">
                NIM: <%= typeof user !== 'undefined' ? user.id_anggota : '123456789' %>
              </p>
              <div class="inline-flex items-center px-3 py-1 rounded-full bg-orange-100 text-orange-700 text-sm font-medium">
                <div class="w-2 h-2 rounded-full bg-orange-500 mr-2"></div>
                Aktif
              </div>
            </div>
          </div>

          <!-- Details Grid -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <!-- Email -->
            <div class="bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors duration-200">
              <div class="flex items-start gap-4">
                <div class="p-3 bg-orange-100 rounded-xl">
                  <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M16 12a4 4 0 10-8 0 4 4 0 008 0zm0 0v1.5a2.5 2.5 0 005 0V12a9 9 0 10-9 9m4.5-1.206a8.959 8.959 0 01-4.5 1.207"/>
                  </svg>
                </div>
                <div class="flex-1">
                  <p class="text-sm font-medium text-gray-500 mb-1">Email</p>
                  <p class="font-semibold text-gray-900 text-base break-all">
                    <%= typeof user !== 'undefined' ? user.email : 'user@example.com' %>
                  </p>
                </div>
              </div>
            </div>

            <!-- Divisi -->
            <div class="bg-gray-50 rounded-2xl p-4 hover:bg-gray-100 transition-colors duration-200">
              <div class="flex items-start gap-4">
                <div class="p-3 bg-orange-100 rounded-xl">
                  <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                      d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                  </svg>
                </div>
                <div class="flex-1">
                  <p class="text-sm font-medium text-gray-500 mb-1">Divisi</p>
                  <p class="font-semibold text-gray-900 text-base">
                    <%= typeof user !== 'undefined' ? (user.divisi || 'Belum ditentukan') : 'Teknologi Informasi' %>
                  </p>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Button -->
          <div class="flex justify-end">
            <button id="editProfileBtn"
              class="px-4 py-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-medium rounded-xl shadow hover:shadow-lg hover:from-orange-600 hover:to-orange-700 transition-all duration-200 flex items-center gap-2 text-sm">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
              </svg>
              Edit Profil
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Edit Photo -->
  <div id="editPhotoModal"
    class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 px-4">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 animate-slide-in">
      
      <!-- Modal Header -->
      <div class="flex items-center gap-3 mb-5">
        <div class="p-2 bg-orange-100 rounded-lg">
          <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
          </svg>
        </div>
        <h2 class="text-xl font-bold text-gray-900">Edit Foto Profil</h2>
      </div>

      <!-- Photo Preview -->
      <div id="currentPhotoContainer" class="flex justify-center mb-5">
        <div class="relative">
          <% if (typeof user !== 'undefined' && user.foto_profile) { %>
            <img id="currentPhoto" src="/uploads/<%= user.foto_profile %>" alt="Foto Profil Saat Ini"
              class="w-24 h-24 rounded-2xl border-4 border-white shadow-lg object-cover ring-2 ring-gray-100">
          <% } else { %>
            <div id="currentPhoto" class="w-24 h-24 rounded-2xl bg-gradient-to-br from-orange-400 to-orange-600 flex items-center justify-center text-white font-bold text-3xl shadow-lg ring-2 ring-gray-100">
              <%= typeof user !== 'undefined' ? (user.nama || 'A').charAt(0).toUpperCase() : 'A' %>
            </div>
          <% } %>
        </div>
      </div>

      <!-- Upload Form -->
      <form id="photoUploadForm" action="/hmsi/profile/upload-foto" method="POST" enctype="multipart/form-data" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Pilih Foto Baru</label>
          <input type="file" id="fotoUpload" name="foto" accept="image/*"
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white text-sm">
          <p class="text-xs text-gray-500 mt-1">Format: JPG, PNG, maksimal 5MB</p>
        </div>

        <!-- Preview New Photo -->
        <div id="newPhotoPreview" class="hidden mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">Preview Foto Baru</label>
          <div class="flex justify-center">
            <img id="previewImage" class="w-24 h-24 rounded-2xl shadow-lg object-cover ring-2 ring-orange-200">
          </div>
        </div>

        <!-- Form Actions -->
        <div class="flex gap-3 pt-3">
          <button type="button" id="cancelPhotoEdit"
            class="flex-1 px-4 py-2 border border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors duration-200 text-sm">
            Batal
          </button>
          <button type="submit" id="uploadPhotoBtn" disabled
            class="flex-1 px-4 py-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-medium rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all duration-200 shadow hover:shadow-lg text-sm disabled:opacity-50 disabled:cursor-not-allowed">
            Upload
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Edit Profile -->
  <div id="editProfileModal"
    class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 px-4">
    <div class="bg-white rounded-2xl shadow-xl w-full max-w-sm p-6 animate-slide-in">
      
      <!-- Modal Header -->
      <div class="flex items-center gap-3 mb-5">
        <div class="p-2 bg-orange-100 rounded-lg">
          <svg class="w-5 h-5 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
              d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
          </svg>
        </div>
        <h2 class="text-xl font-bold text-gray-900">Edit Profil</h2>
      </div>

      <!-- Form -->
      <form action="/hmsi/profile/update" method="POST" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Nama Lengkap</label>
          <input type="text" name="nama" value="<%= typeof user !== 'undefined' ? user.nama : '' %>"
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white text-sm"
            required>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Password Baru</label>
          <input type="password" name="password"
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white text-sm"
            placeholder="Kosongkan jika tidak ingin mengubah">
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Konfirmasi Password</label>
          <input type="password" name="confirmPassword"
            class="w-full px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white text-sm"
            placeholder="Konfirmasi password baru">
        </div>

        <!-- Form Actions -->
        <div class="flex gap-3 pt-3">
          <button type="button" id="cancelEdit"
            class="flex-1 px-4 py-2 border border-gray-200 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors duration-200 text-sm">
            Batal
          </button>
          <button type="submit"
            class="flex-1 px-4 py-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white font-medium rounded-lg hover:from-orange-600 hover:to-orange-700 transition-all duration-200 shadow hover:shadow-lg text-sm">
            Simpan
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    document.addEventListener("DOMContentLoaded", function() {
      // Profile Edit Modal
      const profileModal = document.getElementById("editProfileModal");
      const openProfileBtn = document.getElementById("editProfileBtn");
      const closeProfileBtn = document.getElementById("cancelEdit");

      // Photo Edit Modal
      const photoModal = document.getElementById("editPhotoModal");
      const openPhotoBtn = document.getElementById("editPhotoBtn");
      const closePhotoBtn = document.getElementById("cancelPhotoEdit");
      const fileInput = document.getElementById("fotoUpload");
      const uploadBtn = document.getElementById("uploadPhotoBtn");
      const previewContainer = document.getElementById("newPhotoPreview");
      const previewImage = document.getElementById("previewImage");

      function openModal(modal) {
        modal.classList.remove("hidden");
        document.body.style.overflow = "hidden";
      }

      function closeModal(modal) {
        modal.classList.add("hidden");
        document.body.style.overflow = "auto";
      }

      // Profile Modal Events
      openProfileBtn.addEventListener("click", () => openModal(profileModal));
      closeProfileBtn.addEventListener("click", () => closeModal(profileModal));
      
      // Photo Modal Events
      openPhotoBtn.addEventListener("click", () => openModal(photoModal));
      closePhotoBtn.addEventListener("click", () => {
        closeModal(photoModal);
        resetPhotoForm();
      });

      // File Input Change Event
      fileInput.addEventListener("change", function(e) {
        const file = e.target.files[0];
        if (file) {
          // Validate file size (5MB max)
          if (file.size > 5 * 1024 * 1024) {
            alert("Ukuran file terlalu besar. Maksimal 5MB.");
            resetPhotoForm();
            return;
          }

          // Validate file type
          if (!file.type.startsWith('image/')) {
            alert("File harus berupa gambar.");
            resetPhotoForm();
            return;
          }

          // Show preview and hide current photo
          const reader = new FileReader();
          reader.onload = function(e) {
            previewImage.src = e.target.result;
            previewContainer.classList.remove("hidden");
            document.getElementById("currentPhotoContainer").classList.add("hidden");
            uploadBtn.disabled = false;
          };
          reader.readAsDataURL(file);
        } else {
          resetPhotoForm();
        }
      });

      function resetPhotoForm() {
        fileInput.value = "";
        previewContainer.classList.add("hidden");
        document.getElementById("currentPhotoContainer").classList.remove("hidden");
        uploadBtn.disabled = true;
      }
      
      // Close modals when clicking outside
      [profileModal, photoModal].forEach(modal => {
        modal.addEventListener("click", function(e) {
          if (e.target === modal) {
            closeModal(modal);
            if (modal === photoModal) resetPhotoForm();
          }
        });
      });

      // Close modals with Escape key
      document.addEventListener("keydown", function(e) {
        if (e.key === "Escape") {
          if (!profileModal.classList.contains("hidden")) {
            closeModal(profileModal);
          }
          if (!photoModal.classList.contains("hidden")) {
            closeModal(photoModal);
            resetPhotoForm();
          }
        }
      });

      // Photo upload form submission
      document.getElementById("photoUploadForm").addEventListener("submit", function(e) {
        uploadBtn.textContent = "Uploading...";
        uploadBtn.disabled = true;
      });
    });
  </script>
</body>
</html>