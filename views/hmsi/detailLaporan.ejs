<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title><%= title %></title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">

  <%- include('../partials/navbarHMSI', { user: user, unreadCount: unreadCount }) %>
  <%- include('../partials/sidebarHMSI', { activeNav: 'laporan', user: user }) %>

  <main class="lg:ml-80 px-6 pt-20 pb-8 flex-grow">
    <div class="max-w-5xl mx-auto bg-white shadow-xl rounded-2xl overflow-hidden border border-gray-200">

      <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-6 py-6">
        <h1 class="text-2xl font-bold">Detail Laporan Kegiatan</h1>
        <p class="text-sm text-orange-100">Informasi lengkap laporan yang telah diajukan</p>
      </div>

      <div class="p-6 sm:p-8 space-y-10">

        <% const boxField = (label, value, isMultiline = false) => { %>
          <div class="bg-gray-50/70 border border-gray-200 rounded-xl p-4 transition hover:bg-gray-100/50">
            <label class="block text-sm font-medium text-gray-600 mb-1"><%= label %></label>
            <div class="w-full px-3 py-2 text-gray-800 bg-white border border-gray-300 rounded-lg">
              <% if (isMultiline) { %>
                <div class="whitespace-pre-wrap"><%= value || '-' %></div>
              <% } else { %>
                <p><%= value || '-' %></p>
              <% } %>
            </div>
          </div>
        <% } %>

        <section>
          <h4 class="text-lg font-semibold text-gray-800 border-b pb-2 mb-4">Informasi Dasar</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="md:col-span-2"><%- boxField('Judul Laporan', laporan.judul_laporan) %></div>
            <%- boxField('Program Kerja Terkait', laporan.namaProker) %>
            <%- boxField('Tanggal Pelaksanaan', laporan.tanggalFormatted) %>
            <div class="md:col-span-2"><%- boxField('Waktu & Tempat', laporan.waktu_tempat) %></div>
            <div class="md:col-span-2"><%- boxField('Deskripsi Kegiatan', laporan.deskripsi_kegiatan, true) %></div>
            <div class="md:col-span-2"><%- boxField('Sasaran Kegiatan', laporan.sasaran, true) %></div>
          </div>
        </section>

        <section>
          <h4 class="text-lg font-semibold text-gray-800 border-b pb-2 mb-4">Informasi Keuangan</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <% const sumberDana = laporan.sumber_dana === 'Uang Kas HMSI' ? 'Uang Kas HMSI' : (laporan.sumber_dana_lainnya || laporan.sumber_dana); %>
            <%- boxField('Sumber Dana', sumberDana) %>
            <% const danaTerpakai = laporan.dana_terpakai ? `Rp ${parseInt(laporan.dana_terpakai).toLocaleString('id-ID')}` : '-'; %>
            <%- boxField('Dana Terpakai', danaTerpakai) %>
          </div>
        </section>

        <section>
          <h4 class="text-lg font-semibold text-gray-800 border-b pb-2 mb-4">ðŸŽ¯ Target Pencapaian</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <%- boxField('Target Kuantitatif', `${laporan.persentase_kuantitatif || 0}%`) %>
            <%- boxField('Target Kualitatif', `${laporan.persentase_kualitatif || 0}%`) %>
            <div class="md:col-span-2"><%- boxField('Deskripsi Capaian Kuantitatif', laporan.deskripsi_target_kuantitatif, true) %></div>
            <div class="md:col-span-2"><%- boxField('Deskripsi Capaian Kualitatif', laporan.deskripsi_target_kualitatif, true) %></div>
          </div>
        </section>

        <section>
          <h4 class="text-lg font-semibold text-gray-800 border-b pb-2 mb-4">Kendala dan Solusi</h4>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <%- boxField('Kendala yang Dihadapi', laporan.kendala, true) %>
            <%- boxField('Solusi yang Diterapkan', laporan.solusi, true) %>
          </div>
        </section>

        <section>
          <h4 class="text-lg font-semibold text-gray-800 border-b pb-2 mb-4">ðŸ“„ Dokumen Pendukung</h4>
          <div class="bg-gray-50/70 border border-gray-200 rounded-xl p-4">
            <% if (laporan.dokumentasi) { %>
              <% const filePath = `/uploads/laporan/${laporan.dokumentasi}`; %>
              
              <div class="mb-4 p-2 border-2 border-dashed rounded-lg bg-white">
                <% if (laporan.dokumentasi_mime === 'application/pdf') { %>
                  <embed src="<%= filePath %>#toolbar=0&navpanes=0" type="application/pdf" width="100%" height="500px" />
                <% } else if (laporan.dokumentasi_mime && laporan.dokumentasi_mime.startsWith('image/')) { %>
                  <img src="<%= filePath %>" class="w-full max-h-[500px] object-contain rounded" alt="Pratinjau Dokumen"/>
                <% } else { %>
                  <p class="text-gray-600 text-center py-10">Pratinjau tidak tersedia untuk tipe file ini.</p>
                <% } %>
              </div>

              <a href="<%= filePath %>" download
                 class="inline-flex items-center gap-2 px-4 py-2 bg-orange-500 text-white text-sm font-medium rounded-lg hover:bg-orange-600 transition-colors">
                <i class="fa-solid fa-download"></i>
                <span>Download File</span>
              </a>
            <% } else { %>
              <p class="text-center text-gray-500 italic py-4">Tidak ada dokumen pendukung yang diunggah.</p>
            <% } %>
          </div>
        </section>

        <div class="pt-6 border-t flex flex-col sm:flex-row gap-3 justify-end">
          <a href="/hmsi/laporan"
             class="w-full sm:w-auto text-center px-6 py-3 border border-gray-300 rounded-xl text-sm bg-white text-gray-700 font-medium hover:bg-gray-100 transition">
             Kembali
          </a>
        </div>

      </div>
    </div>
  </main>
  
  <%- include('../partials/footer') %>

</body>
</html>